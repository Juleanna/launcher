# Руководство пользователя лаунчера

Это подробное руководство по установке, настройке и использованию лаунчера для обновления клиента игры и получения актуального контента.

## Возможности
- Автоматическая проверка и установка обновлений лаунчера и игровых файлов
- Докачка прерванных загрузок, отображение скорости и прогресса
- Верификация целостности обновлений по публичному ключу (RSA-PSS-SHA256)
- Безопасная распаковка (защита от path traversal и zip-bomb)
- Резервные копии и откат (опционально)
- Delta-обновления (опционально, при наличии паков разницы)
- Встроенный показ новостей и контента с сайта (JSON/RSS/HTML)
- Системный трей и управление из трея

## Требования к системе
- Windows 10/11 (x64)
- Python 3.8+ (для запуска из исходников) или готовая сборка .exe
- Интернет‑соединение к серверу обновлений

## Установка
1) Установите зависимости (если запускаете из исходников):
   - `pip install -r requirements.txt`
2) Сгенерируйте ресурсы Qt (при необходимости):
   - `pyrcc5 res.qrc -o res.py`
3) Запустите лаунчер:
   - `python Launcher.py`
   - или используйте собранный `Launcher.exe`.

## Быстрый старт
- При первом запуске лаунчер прочитает `launcher_config.ini`, проверит наличие обновления лаунчера, затем — игровых файлов.
- При включённой подписи лаунчер проверит целостность паков по публичному ключу.

## Интерфейс
- Главное окно: кнопки запуска/обновления, индикатор прогресса, информационная область.
- Системный трей: иконка, возможность свернуть/развернуть и открыть меню.
- Новости/контент: вкладка с лентой новостей в зависимости от настроек `WebContent` и источников `NewsSource*`.

## Конфигурация: launcher_config.ini
Разделы и ключи (основные):

- [Server]
  - `name` — отображаемое имя сервера/проекта
  - `version` — версия сервера (для информации)

- [Launcher]
  - `version` — текущая версия лаунчера. Лаунчер сравнивает её с `version.txt` на сервере

- [Links]
  - `telegram`, `vk`, `discord`, `website`, `facebook`, `instagram` — ссылки в интерфейсе

- [Icon]
  - `path` — путь к иконке, например `images/logo.png`

- [Images]
  - `folder` — папка с баннерами/картинками (необязательно)

- [ButtonColors]
  - `default`, `active` — цвета кнопок в HEX (`#rrggbb`)

- [Slider]
  - `interval` — интервал смены слайдов (мс)

- [Update]
  - `update_url` — базовый URL каталога обновлений игровых файлов
  - `version_file` — имя файла версии на сервере (обычно `version.txt`)
  - `files_list_prefix` — префикс архивов со списком файлов (например `files_list_v`)
  - `launcher_update_url` — URL обновления лаунчера (zip с обновлением лаунчера)
  - `launcher_update_filename` — имя файла архива лаунчера (например `launcher_update.zip`)
  - `public_key_url` — HTTPS‑URL публичного ключа (PEM), используемого для проверки подписи

- [WebContent]
  - `auto_refresh` — `1` для автообновления, `0` — выкл.
  - `refresh_interval` — период обновления (сек)

- [NewsSourceN]
  - `name` — имя источника
  - `url` — адрес источника (JSON/RSS/HTML)
  - `type` — тип: `json` | `rss` | `html`
  - `enabled` — `1`/`0`

Примечания по безопасности и средам:
- Для локальной разработки используйте `http://127.0.0.1:PORT` или доверенный локальный сертификат. В продакшне используйте валидный HTTPS.
- Публичный ключ можно хранить локально (`crypto_keys/public_key.pem`) или раздавать по `public_key_url`.

## Как работает обновление
1) Проверка обновления лаунчера
   - Лаунчер читает `version.txt` на сервере, сравнивает `LauncherVersion` с локальной `Launcher.version`.
   - При наличии новой версии скачивает `launcher_update.zip` и проверяет целостность (подпись/хеш).
   - Безопасно распаковывает и обновляет лаунчер, затем перезапускается (если предусмотрено).

2) Проверка игровых файлов
   - Скачивается пакет списка/манифест (`files_list_vX.zip` и/или `.manifest`).
   - Сравниваются локальные и удалённые файлы; при необходимости скачиваются недостающие/изменённые.
   - Поддерживается докачка (ResumableDownload), статистика, пауза/возобновление.
   - Delta‑обновления применяются при наличии и выгодности.

3) Проверка целостности
   - Используется публичный ключ (RSA‑PSS‑SHA256) и манифест подписей.
   - При недоступности манифеста допускается проверка по `.hash` (если включено на стороне генерации).

4) Распаковка
   - Фильтрация расширений, защита от path traversal и zip‑bomb.

## Частые проблемы
- Соединение отклонено (connection refused)
  - Проверьте `update_url`/порт/фаервол, что сервер обновлений доступен.
- Ошибка TLS при `https://127.0.0.1/...`
  - Для локалки используйте `http://` или установите корректный сертификат.
- Ошибка подписи/хеша
  - Убедитесь, что манифест/ключ соответствует версии, скачайте заново публичный ключ (`public_key_url`).

## Журналы
- Файлы логов: `logs/launcher.log`, `logs/launcher_errors.log`
- Уровень логирования настраивается в `launcher_log_config.py`

## Сборка
- Рекомендуемая сборка: `pyinstaller --clean --noconfirm Launcher.spec`
- В `.spec` автоматически собираются данные PyQt5; UPX отключён для переносимости

## FAQ
- Где хранить приватный ключ? — Только в офлайн‑инструменте (на сервере сборки). Клиенту нужен лишь публичный ключ.
- Можно ли отключить верификацию? — Не рекомендуется. Лучше корректно настроить ключи и HTTPS.
- Как изменить внешний вид? — Используйте редактор UI (см. UI_EDITOR_README.md) и параметры в `launcher_config.ini`.

